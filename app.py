import streamlit as st
import openai


st.set_page_config(page_title="GPT-3.5 Turbo and DALL-E App", page_icon="ğŸ¤–", layout="wide")

# Define a function to get the GPT-3.5 response
@st.cache_data
def get_gpt_response(api_key, question):
    openai.api_key = api_key
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": "You are a helpful assistant."},
            {"role": "user", "content": question}
        ]
    )
    return response.choices[0].message['content']

# Define a function to get the DALL-E image URL
@st.cache_data
def get_dalle_image(api_key, prompt):
    openai.api_key = api_key
    response = openai.Image.create(
        prompt=prompt,
        n=1,
        size="512x512"
    )
    return response['data'][0]['url']

# Sidebar for navigation
page = st.sidebar.selectbox("Select a page", ["GPT-3.5 Chatbot", "DALL-E Image Generator"])

# Common API key input
api_key = st.sidebar.text_input("OpenAI API Key", type="password")
if api_key:
    st.session_state["api_key"] = api_key

# Page 1: GPT-3.5 Chatbot
if page == "GPT-3.5 Chatbot":
    st.title("ê¸ˆíƒœì–‘ ë©”ì´ìŠ¨ë´‡")
    st.write("5252 ë¬»ê³ ì‹¶ì€ê²Œ ìˆìœ¼ë©´ APIí‚¤ë¥¼ ë‚´ë†”ì•¼í• ê±° ì•„ëƒ?")
    
    question = st.text_input("ë­.. ê·¸ë˜ì„œ ë¬»ê³  ì‹¶ì€ê²Œ ë­”ë°")
    
    if question:
        if "api_key" in st.session_state:
            response = get_gpt_response(st.session_state["api_key"], question)
            st.write("Response from GPT-3.5 Turbo:")
            st.write(response)
        else:
            st.write("ì•¼ ì¥ë‚œí•˜ëƒ APIí‚¤ ë‚´ë†“ìœ¼ë¼ê³ .")
    
# Page 2: DALL-E Image Generator
elif page == "DALL-E Image Generator":
    st.title("ê·€ì—¬ìš´ ê³ ì–‘ì´ ë‹¬ì´ì˜ ê·¸ë¦¼íŒ")
    st.write("ì•ˆë‡½ë‡½, ë‹¬ì´ì–‘ ê·¸ë¦¼ì´ ê·¸ë¦¬ê³  ì‹¶ìœ¼ë©´ APIí‚¤ì™€ í”„ë¡¬í”„íŠ¸ë¥¼ ë‹¬ë¼ëƒ¥!")
    
    prompt = st.text_input("ì–´ë–¤ ê·¸ë¦¼ì„ ì›í•˜ëŠ”ì§€ ì„¤ëª…í•´ ë‹¬ë¼ëƒ¥")
    
    if prompt:
        if "api_key" in st.session_state:
            image_url = get_dalle_image(st.session_state["api_key"], prompt)
            st.image(image_url, caption="Generated by DALL-E", use_column_width=True)
        else:
            st.write("ëƒ¥... APIí‚¤ë¥¼ ì ì–´ì£¼ì§€ ì•Šìœ¼ë©´ ë‹¬ì´ëŠ” ê·¸ë¦¼ì„ ê·¸ë¦´ìˆ˜ ì—†ë‹¤ëƒ¥...")
